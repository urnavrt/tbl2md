<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tbl2Md</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- CSS Variables & Theming --- */
        :root {
            --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            --font-mono: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;

            /* Light Theme */
            --bg: #f7f8fa;
            --bg-panel: #ffffff;
            --bg-input: #f1f3f5;
            --bg-hover: #e9ecef;
            --text-primary: #212529;
            --text-secondary: #868e96;
            --border: #dee2e6;
            --accent: #3b82f6;
            --accent-text: #ffffff;
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.07), 0 2px 4px -2px rgba(0,0,0,0.07);
        }

        body.dark-mode {
            /* Dark Theme */
            --bg: #121212;
            --bg-panel: #1e1e1e;
            --bg-input: #2c2c2c;
            --bg-hover: #3a3a3a;
            --text-primary: #e9ecef;
            --text-secondary: #adb5bd;
            --border: #495057;
            --accent: #60a5fa;
            --accent-text: #121212;
        }

        /* --- Base & Reset --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-sans);
            background-color: var(--bg);
            color: var(--text-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
            padding: 2rem 1rem;
        }

        /* --- Header --- */
        .page-header {
            max-width: 1200px;
            margin: 0 auto 2rem auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-header h1 {
            font-size: 2rem;
            font-weight: 700;
        }

        /* --- Theme Toggle Button --- */
        .theme-toggle {
            background-color: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 999px;
            cursor: pointer;
            padding: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            position: relative;
            width: 44px;
            height: 44px;
            overflow: hidden;
        }
        .theme-toggle:hover {
            background-color: var(--bg-hover);
        }
        .theme-toggle svg {
            position: absolute;
            transition: transform 0.3s ease, opacity 0.2s ease;
            width: 20px;
            height: 20px;
        }
        #sun-icon { transform: translateY(0); opacity: 1; }
        #moon-icon { transform: translateY(30px); opacity: 0; }
        .dark-mode #sun-icon { transform: translateY(-30px); opacity: 0; }
        .dark-mode #moon-icon { transform: translateY(0); opacity: 1; }


        /* --- Main Layout --- */
        .main-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            max-width: 1200px;
            margin: 0 auto;
            height: calc(100vh - 12rem);
            min-height: 500px;
        }

        .panel {
            background-color: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 12px;
            box-shadow: var(--shadow);
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        /* --- Input Panel --- */
        .input-panel {
            gap: 2rem;
        }
        .panel-section {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        .panel-section.full-height {
            flex-grow: 1;
            min-height: 0;
        }
        .panel-section h3 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-secondary);
        }

        textarea {
            width: 100%;
            height: 100%;
            padding: 0.75rem 1rem;
            background-color: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-family: var(--font-mono);
            font-size: 0.9rem;
            color: var(--text-primary);
            resize: none;
            transition: all 0.2s ease;
        }
        textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 2px var(--accent-text), 0 0 0 4px var(--accent);
        }

        .controls-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        .control-group { display: flex; flex-direction: column; gap: 0.5rem; }
        
        select {
            width: 100%;
            padding: 0.6rem 0.75rem;
            border-radius: 6px;
            border: 1px solid var(--border);
            background-color: var(--bg-input);
            color: var(--text-primary);
            font-size: 0.9rem;
            font-family: var(--font-sans);
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            transition: all 0.2s ease;
        }
        select:focus {
            outline: none;
            border-color: var(--accent);
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            background-color: var(--bg-input);
            padding: 0.6rem 0.75rem;
            border-radius: 6px;
            border: 1px solid var(--border);
            height: 100%;
        }
        #trim-whitespace {
            width: 16px; height: 16px;
            accent-color: var(--accent);
        }

        /* Segmented Control for Output Type */
        .segmented-control {
            display: flex;
            background-color: var(--bg-input);
            border-radius: 8px;
            padding: 4px;
            border: 1px solid var(--border);
        }
        .segmented-control input { display: none; }
        .segmented-control label {
            flex: 1;
            text-align: center;
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 0.2s ease-in-out;
            color: var(--text-secondary);
        }
        .segmented-control input:checked + label {
            background-color: var(--bg-panel);
            color: var(--text-primary);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        /* --- Output Panel & Tabs --- */
        .output-panel {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .tabs {
            display: flex;
            gap: 0.5rem;
            border-bottom: 1px solid var(--border);
        }
        .tab-button {
            padding: 0.5rem 1rem;
            border: none;
            background: none;
            cursor: pointer;
            font-family: var(--font-sans);
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--text-secondary);
            border-bottom: 2px solid transparent;
            margin-bottom: -1px;
            transition: all 0.2s ease;
        }
        .tab-button.active {
            color: var(--accent);
            border-bottom-color: var(--accent);
        }
        .tab-button.hidden {
            display: none;
        }

        .tab-content {
            flex-grow: 1;
            position: relative;
            min-height: 0;
        }
        .tab-pane {
            display: none;
            height: 100%;
            width: 100%;
        }
        .tab-pane.active {
            display: block;
        }

        #copy-button {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            background-color: var(--bg-input);
            color: var(--text-primary);
            border: 1px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            padding: 0.5rem;
            opacity: 0.7;
            transition: all 0.2s ease;
            z-index: 10;
        }
        #copy-button:hover { opacity: 1; background-color: var(--bg-hover); }
        #copy-button svg { width: 18px; height: 18px; transition: transform 0.2s ease, opacity 0.2s ease; }
        #copy-button .check-icon { position: absolute; transform: scale(0.5); opacity: 0; }
        #copy-button.copied .copy-icon { transform: scale(0.5); opacity: 0; }
        #copy-button.copied .check-icon { transform: scale(1); opacity: 1; }

        #markdown-preview {
            overflow: auto;
            height: 100%;
            padding: 0.25rem;
        }
        #markdown-preview table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }
        #markdown-preview th, #markdown-preview td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        #markdown-preview th {
            font-weight: 600;
            background-color: var(--bg-input);
        }
        #markdown-preview tr:nth-child(even) { background-color: var(--bg-input); }
        #markdown-preview th:first-child { border-top-left-radius: 8px; }
        #markdown-preview th:last-child { border-top-right-radius: 8px; }

        /* --- Responsive Design --- */
        @media (max-width: 900px) {
            .main-container {
                grid-template-columns: 1fr;
                height: auto;
            }
        }
        @media (max-width: 600px) {
            body { padding: 1rem; }
            .page-header { flex-direction: column; align-items: flex-start; gap: 1rem; }
            .controls-grid { grid-template-columns: 1fr; }
        }

    </style>
</head>
<body>

    <header class="page-header">
        <h1>Tbl2Md</h1>
        <button class="theme-toggle" id="theme-toggle" title="Toggle theme">
            <svg id="sun-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.106a.75.75 0 010 1.06l-1.591 1.59a.75.75 0 11-1.06-1.06l1.59-1.591a.75.75 0 011.06 0zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.894 17.894a.75.75 0 011.06 0l1.59 1.591a.75.75 0 11-1.06 1.06l-1.591-1.59a.75.75 0 010-1.06zM12 18.75a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0v-2.25a.75.75 0 01.75-.75zM5.106 17.894a.75.75 0 010-1.06l1.591-1.59a.75.75 0 011.06 1.06l-1.59 1.591a.75.75 0 01-1.06 0zM2.25 12a.75.75 0 01.75-.75h2.25a.75.75 0 010 1.5H3a.75.75 0 01-.75-.75zM6.106 5.106a.75.75 0 011.06 0l1.59 1.591a.75.75 0 01-1.06 1.06l-1.591-1.59a.75.75 0 010-1.06z"></path></svg>
            <svg id="moon-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 01.162.819A8.97 8.97 0 009 6a9 9 0 009 9 8.97 8.97 0 004.472-.69a.75.75 0 01.82.162a10.5 10.5 0 11-19.12-6.556a.75.75 0 01.75-.062z" clip-rule="evenodd"></path></svg>
        </button>
    </header>

    <main class="main-container">
        <!-- LEFT PANEL: INPUT & CONTROLS -->
        <div class="panel input-panel">
            <div class="panel-section full-height">
                <h3>Input</h3>
                <textarea id="input-area" placeholder="Paste your Excel data here.
Rows are separated by new lines, and columns by tabs."></textarea>
            </div>
            <div class="panel-section">
                <h3>Settings</h3>
                <div class="segmented-control">
                    <input type="radio" id="type-markdown" name="output-type" value="markdown" checked>
                    <label for="type-markdown">Markdown</label>
                    <input type="radio" id="type-json" name="output-type" value="json">
                    <label for="type-json">JSON</label>
                </div>
                <div class="controls-grid">
                    <div class="control-group">
                        <select id="header-casing">
                            <option value="none">Header: None</option>
                            <option value="lower">Header: lowercase</option>
                            <option value="upper">Header: UPPERCASE</option>
                            <option value="snake">Header: snake_case</option>
                            <option value="kebab">Header: kebab-case</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="trim-whitespace" checked>
                            <label for="trim-whitespace">Trim Whitespace</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- RIGHT PANEL: OUTPUT -->
        <div class="panel output-panel">
            <div class="tabs">
                <button class="tab-button active" data-tab="code">Code</button>
                <button class="tab-button" data-tab="preview">Preview</button>
            </div>
            <div class="tab-content">
                <div id="code-pane" class="tab-pane active">
                    <button id="copy-button" title="Copy to Clipboard">
                        <svg class="copy-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 015.25 6h.008a2.25 2.25 0 012.242 2.15 2.25 2.25 0 01-.1.664M6.75 15h.008v.008H6.75V15zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"></path></svg>
                        <svg class="check-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5"></path></svg>
                    </button>
                    <textarea id="output-area" readonly placeholder="Output will appear here..."></textarea>
                </div>
                <div id="preview-pane" class="tab-pane">
                    <div id="markdown-preview"></div>
                </div>
            </div>
        </div>
    </main>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- DOM Element References ---
        const inputArea = document.getElementById('input-area');
        const outputArea = document.getElementById('output-area');
        const trimWhitespaceCheckbox = document.getElementById('trim-whitespace');
        const headerCasingSelect = document.getElementById('header-casing');
        const outputTypeRadios = document.querySelectorAll('input[name="output-type"]');
        
        const markdownPreview = document.getElementById('markdown-preview');
        const copyButton = document.getElementById('copy-button');
        const themeToggle = document.getElementById('theme-toggle');

        const tabButtons = document.querySelectorAll('.tab-button');
        const tabPanes = document.querySelectorAll('.tab-pane');
        const previewTabButton = document.querySelector('.tab-button[data-tab="preview"]');

        // --- Core Processing Logic ---
        const processData = () => {
            const rawText = inputArea.value;
            const outputType = document.querySelector('input[name="output-type"]:checked').value;

            // Smartly show/hide preview tab
            previewTabButton.classList.toggle('hidden', outputType !== 'markdown');
            if (outputType !== 'markdown' && previewTabButton.classList.contains('active')) {
                // If preview tab was active and is now hidden, switch to code tab
                switchTab('code');
            }

            if (!rawText.trim()) {
                clearOutputs();
                return;
            }

            const shouldTrim = trimWhitespaceCheckbox.checked;
            const casing = headerCasingSelect.value;
            
            const rows = rawText.split('\n').filter(row => row.trim() !== '');
            if (rows.length === 0) {
                clearOutputs();
                return;
            }

            let header = rows[0].split('\t');
            let data = rows.slice(1).map(row => row.split('\t'));

            if (shouldTrim) {
                header = header.map(cell => cell.trim());
                data = data.map(row => row.map(cell => cell.trim()));
            }
            
            const colCount = header.length;
            data = data.map(row => {
                while (row.length < colCount) row.push('');
                return row.slice(0, colCount);
            });

            const applyCasing = (h) => {
                const cleanHeader = h.trim();
                switch (casing) {
                    case 'lower': return cleanHeader.toLowerCase();
                    case 'upper': return cleanHeader.toUpperCase();
                    case 'snake': return cleanHeader.toLowerCase().replace(/\s+/g, '_').replace(/[^\w_]/g, '');
                    case 'kebab': return cleanHeader.toLowerCase().replace(/\s+/g, '-').replace(/[^\w-]/g, '');
                    default: return cleanHeader;
                }
            };
            const processedHeader = header.map(applyCasing);

            let output = '';
            if (outputType === 'markdown') {
                output = generateMarkdown(processedHeader, data);
                updateMarkdownPreview(processedHeader, data);
            } else {
                output = generateJson(processedHeader, data);
            }
            
            outputArea.value = output;
        };

        const generateMarkdown = (header, data) => {
            if (header.length === 0) return '';
            const headerRow = `| ${header.join(' | ')} |`;
            const separatorRow = `|${header.map(() => ' --- ').join('|')}|`;
            const dataRows = data.map(row => `| ${row.join(' | ')} |`).join('\n');
            return `${headerRow}\n${separatorRow}\n${dataRows}`;
        };

        const generateJson = (header, data) => {
            const jsonData = data.map(row => {
                const obj = {};
                header.forEach((key, i) => {
                    obj[key] = row[i] || '';
                });
                return obj;
            });
            return JSON.stringify(jsonData, null, 2);
        };

        const updateMarkdownPreview = (header, data) => {
            if (header.length === 0 && data.length === 0) {
                markdownPreview.innerHTML = `<p style="color: var(--text-secondary); padding: 1rem;">Preview will appear here</p>`;
                return;
            }
            const table = document.createElement('table');
            const thead = table.createTHead();
            const headerRow = thead.insertRow();
            header.forEach(text => {
                const th = document.createElement('th');
                th.textContent = text;
                headerRow.appendChild(th);
            });

            const tbody = table.createTBody();
            data.forEach(rowData => {
                const row = tbody.insertRow();
                rowData.forEach(text => {
                    const td = row.insertCell();
                    td.textContent = text;
                });
            });

            markdownPreview.innerHTML = '';
            markdownPreview.appendChild(table);
        };
        
        const clearOutputs = () => {
            outputArea.value = '';
            markdownPreview.innerHTML = `<p style="color: var(--text-secondary); padding: 1rem;">Preview will appear here</p>`;
        };

        // --- Event Listeners ---
        [inputArea, trimWhitespaceCheckbox, headerCasingSelect].forEach(el => {
            el.addEventListener('input', processData);
            el.addEventListener('change', processData);
        });
        outputTypeRadios.forEach(radio => radio.addEventListener('change', processData));

        copyButton.addEventListener('click', () => {
            if (!outputArea.value || copyButton.classList.contains('copied')) return;
            navigator.clipboard.writeText(outputArea.value).then(() => {
                copyButton.classList.add('copied');
                setTimeout(() => copyButton.classList.remove('copied'), 2000);
            }).catch(err => console.error('Failed to copy:', err));
        });
        
        // --- Tab Logic ---
        const switchTab = (tabId) => {
             tabButtons.forEach(button => {
                button.classList.toggle('active', button.dataset.tab === tabId);
            });
            tabPanes.forEach(pane => {
                pane.classList.toggle('active', pane.id === `${tabId}-pane`);
            });
        };

        tabButtons.forEach(button => {
            button.addEventListener('click', () => switchTab(button.dataset.tab));
        });

        // --- Theme Switcher ---
        themeToggle.addEventListener('click', () => {
            const isDark = document.body.classList.toggle('dark-mode');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        });

        // Load theme from localStorage
        if (localStorage.getItem('theme') === 'dark') {
            document.body.classList.add('dark-mode');
        }

        // --- Initial Load ---
        processData();
    });
    </script>
</body>
</html>
